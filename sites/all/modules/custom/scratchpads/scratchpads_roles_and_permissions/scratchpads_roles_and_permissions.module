<?php

/**
 * Implements hook_module_implements_alter().
 */
function scratchpads_roles_and_permissions_module_implements_alter(&$implementations, $hook){
  if($hook == 'scratchpads_default_permissions'){
    $implementations = array_merge($implementations, array(
      'biblio' => FALSE,
      'block' => FALSE,
      'comment' => FALSE,
      'contextual' => FALSE,
      'dashboard' => FALSE,
      'feeds' => FALSE,
      'field_group' => FALSE,
      'file_entity' => FALSE,
      'menu' => FALSE,
      'node' => FALSE,
      'clone' => FALSE,
      'overlay' => FALSE,
      'search' => FALSE,
      'shortcut' => FALSE,
      'system' => FALSE,
      'taxonomy' => FALSE,
      'toolbar' => FALSE,
      'tools' => FALSE,
      'user' => FALSE,
      'views' => FALSE
    ));
  }
}

/**
 * Implements hook_hook_info().
 */
function scratchpads_roles_and_permissions_hook_info(){
  return array(
    'scratchpads_default_permissions_alter' => array(
      'group' => 'scratchpads'
    ),
    'scratchpads_default_permissions' => array(
      'group' => 'scratchpads'
    )
  );
}

/**
 * Implements hook_modules_enabled().
 */
function scratchpads_roles_and_permissions_modules_enabled($modules){
  $default_permissions = module_invoke_all('scratchpads_default_permissions');
  drupal_alter('scratchpads_default_permissions', $default_permissions);
  foreach($default_permissions as $role => $permissions){
    // Load the role
    $role = user_role_load_by_name($role);
    if($role){
      user_role_change_permissions($role->rid, drupal_map_assoc($permissions));
    }
  }
}
