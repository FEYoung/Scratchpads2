<?php
/**
 * @file
 * Code for the scratchpads_registry_stats feature.
 */
include_once ('scratchpads_registry_stats.features.inc');

/**
 * Implements hook_cron().
 */
function scratchpads_registry_stats_cron(){
  module_load_include('cron.inc', 'scratchpads_registry_stats');
  _scratchpads_registry_stats_cron();
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function scratchpads_registry_stats_form_gbif_registry_admin_form_alter(&$form, &$form_state, $form_id){
  $results = db_select('users', 'u')->fields('u', array(
    'name',
    'uid'
  ))->condition('uid', 0, '>')->execute();
  $options = array();
  foreach($results as $row){
    $options[$row->uid] = $row->uid . ": " . check_plain($row->name);
  }
  $form['scratchpads_registry_stats_user'] = array(
    '#type' => 'select',
    '#title' => t('Content author'),
    '#description' => t('Select a user that should be used to create the statistical content on this site.'),
    '#options' => $options,
    '#default_value' => variable_get('scratchpads_registry_stats_user', 1)
  );
}

/**
 * Implements hook_menu().
 */
function scratchpads_registry_stats_menu(){
  return array(
    'scratchpad-stats' => array(
      'title' => 'Scratchpad statistics',
      'description' => t('View statistics about all of the ViBRANT Scratchpads'),
      'page callback' => 'scratchpads_registry_stats_statistics_page',
      'access callback' => TRUE,
      'type' => MENU_CALLBACK, // Set as MENU_CALLBACK as we'll use as the front page.
      'file' => 'scratchpads_registry_stats.pages.inc'
    )
  );
}