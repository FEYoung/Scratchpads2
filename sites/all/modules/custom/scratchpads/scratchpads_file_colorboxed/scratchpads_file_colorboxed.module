<?php
include_once ('scratchpads_file_colorboxed.features.inc');

/**
 * Implementation of hook_menu()
 */
function scratchpads_file_colorboxed_menu(){
  return array(
    'file-colorboxed/%' => array(
      'title' => 'Scratchpads colorbox',
      'page callback' => 'scratchpads_file_colorboxed_entity_simple_view',
      'page arguments' => array(
        1
      ),
      'access callback' => 'file_entity_access',
      'access arguments' => array(
        'view'
      )
    )
  );
}

/**
 * Callback for the above menu entry.
 */
function scratchpads_file_colorboxed_entity_simple_view($fid){
  $entity = entity_load_single('file', $fid);
  $view_type = 'file_styles_colorbox';
  // Wrap the audio file specially.
  if($entity->type == 'audio'){
    $width = 'width:400px;';
  }else{
    $width = '';
  }
  // Only use the colorbox display type if we're viewing certain files.
  if(!in_array($entity->type, array(
    'image',
    'video',
    'audio'
  ))){
    $view_type = 'default';
  }
  $content = entity_view('file', array(
    $entity
  ), $view_type);
  echo '<div style="' . $width . 'padding:10px">' . drupal_render($content) . ($entity->type == 'image' ? '<p>' . l(t('Download original'), file_create_url($entity->uri), array(
    'attributes' => array(
      'target' => '_blank'
    )
  )) . '</p>' : '') . '</div>';
  exit();
}