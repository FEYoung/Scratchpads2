<?php

/**
 * Implementation of hook_taxonomy_vocabulary_insert().
 */
function scratchpads_taxonomic_name_field_taxonomy_vocabulary_insert($vocabulary){
  if(isset($vocabulary->biological_classification) && $vocabulary->biological_classification){
    // We have a biological classification.  We need to update the field.
    $field = field_info_field('field_taxonomic_name');
    $bio_vids = variable_get('biological_vids', array());
    $i = 0;
    $field['settings']['allowed_values'] = array();
    foreach($bio_vids as $vid => $value){
      $vocabulary = taxonomy_vocabulary_load($vid);
      if($vocabulary){
        $field['settings']['allowed_values'][$i] = array(
          'parent' => 0,
          'vocabulary' => $vocabulary->machine_name
        );
        $i++;
      }
    }
    $field['settings']['allowed_values'][] = array(
      'parent' => 0,
      'vocabulary' => $vocabulary->machine_name
    );
    field_update_field($field);
  }
}

/**
 * Implementation of hook_taxonomy_vocabulary_delete().
 */
function scratchpads_taxonomic_name_field_taxonomy_vocabulary_delete($vocabulary){
  // We have a biological classification.  We need to update the field.
  $field = field_info_field('field_taxonomic_name');
  $update = FALSE;
  foreach($field['settings']['allowed_values'] as $key => $value){
    if($value['vocabulary'] == $vocabulary->machine_name){
      $update = TRUE;
      unset($field['settings']['allowed_values'][$key]);
      if(!count($field['settings']['allowed_values'])){
        $field['settings']['allowed_values'][0] = array(
          'parent' => 0,
          'vocabulary' => $vocabulary->machine_name
        );
      }
      break;
    }
  }
  if($update){
    field_update_field($field);
  }
}