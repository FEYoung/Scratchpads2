<?php

function emonocot_views_views_api(){
  $path = drupal_get_path('module', 'emonocot_views');
  return array(
    'api' => '3',
    'path' => $path
  );
}

function emonocot_views_context_load_alter(&$context){
  if($context->name === 'species_overview' && isset($context->reactions['block'])){
    //Remove default Scratchpads nomenclature and specimen blocks
    unset($context->reactions['block']['blocks']['views-species_nomenclature-block']);
    unset($context->reactions['block']['blocks']['views-species_specimens_overview-block']);
    foreach ($context->reactions['block']['blocks'] as $name => $block){
    	if (substr($name,0, 29) == 'views-em_species_nomenclature'){
    	  unset($context->reactions['block']['blocks'][$name]);
    	}
    }
    //Replace with the eMonocot one(s)
    global $_GET;
    $args = explode('/', $_GET['q']);
    if($args[0] == 'taxonomy' && $args[1] == 'term' && is_int((int)$args[2])){
      $term = taxonomy_term_load($args[2]);
     
      $bio_id = $term->vid;

      $context->reactions['block']['blocks']['views-em_species_nomenclature_' . $bio_id . '-block'] = array(
        'module' => 'views',
        'delta' => 'em_species_nomenclature_' . $bio_id . '-block',
        'region' => 'content',
        'weight' => -10
      );
      $context->reactions['block']['blocks']['typification_overview'] = array(
        'module' => 'emonocot_blocks',
        'delta' => 'typification_overview',
        'region' => 'content',
        'weight' => -8
      );
      $context->reactions['block']['blocks']['hybrid_children'] = array(
        'module' => 'emonocot_blocks',
        'delta' => 'hybrid_children',
        'region' => 'content',
        'weight' => -7
      );
    }
  }
}
