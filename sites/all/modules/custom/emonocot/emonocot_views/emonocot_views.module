<?php

function emonocot_views_views_api(){
  $path = drupal_get_path('module', 'emonocot_views');
  return array(
    'api' => '3',
    'path' => $path
  );
}

function emonocot_views_context_load_alter(&$context){
  if($context->name === 'species_overview' && isset($context->reactions['block'])){
    //Remove default Scratchpads nomenclature block
    unset($context->reactions['block']['blocks']['views-species_nomenclature-block']);
    //Replace with the eMonocot one(s)
    global $conf;
    $bio_ids = $conf['biological_vids'];
    $bio_names = array(); //of machine names of biologocal vocabs
    global $_GET;
    $args = explode('/', $_GET['q']);
    if($args[0]=='taxonomy' && $args[1]=='term' && is_int((int)$args[2])){
      $result = db_query("SELECT vid FROM {taxonomy_term_data} WHERE tid = :tid", array (':tid' => $args[2]));
      $bio_id  =$result->fetchObject()->vid;
    
      $result = db_query('SELECT machine_name FROM {taxonomy_vocabulary} WHERE vid = :vid', array(':vid' => $bio_id));
      $bio_name = $result->fetchObject()->machine_name;
      $context->reactions['block']['blocks']['views-em_species_nomenclature_' . $bio_name . '-block'] = array(
        'module' => 'views',
        'delta' => 'em_species_nomenclature_' . $bio_name . '-block',
        'region' => 'content',
        'weight' => -10
      );
    }
  }
}
