(function(a){Drupal.GM3.field_polygon=function(b){b.children.polygon.event=function(d,c,m){switch(this.GM3.active_class){case"polygon":switch(d){case"click":this.polygons[this.polygons.length-1].stopEdit();this.polygons[this.polygons.length-1].getPath().push(c.latLng);this.polygons[this.polygons.length-1].runEdit(true);this.update_field();break;case"mousemove":var n=this.polygons[this.polygons.length-1].getPath().getLength();if(n>=1){var h=this.polygons[this.polygons.length-1].getPath().getAt(n-1);var l=[h,c.latLng];this.followline1.setPath(l);var f=this.polygons[this.polygons.length-1].getPath().getAt(0);var k=[f,c.latLng];this.followline2.setPath(k)}break;case"rightclick":this.GM3.set_active_class("default");this.followline1.setMap(null);this.followline2.setMap(null);this.update_field();break}break;case"default":switch(d){case"click":if(m.getClass&&m.getClass()=="Polygon"){for(var e=0;e<this.polygons.length;e++){this.polygons[e].stopEdit()}for(var g=0;g<this.polygons.length;g++){if(m==this.polygons[g]){this.polygons[g].runEdit()}}}else{for(var e=0;e<this.polygons.length;e++){this.polygons[e].stopEdit()}}this.update_field();break;case"rightclick":if(m.getClass&&m.getClass()!="Polygon"){for(var e=0;e<this.polygons.length;e++){this.polygons[e].stopEdit()}}this.update_field();break}break}}};Drupal.GM3.polygon.prototype.update_field=function(){var c="";for(var b=0;b<this.polygons.length;b++){if(c.length){c+="\n"}this.polygons[b].getPaths().forEach(function(e){if(e.length>2){c+="POLYGON ((";for(var d=0;d<e.length;d++){if(d>0){c+=","}c+=e.b[d].lng()+" "+e.b[d].lat()}c+="))"}})}a("."+this.GM3.id+"-polygon").val(c)}})(jQuery);