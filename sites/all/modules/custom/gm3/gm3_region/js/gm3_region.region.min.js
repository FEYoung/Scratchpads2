(function(a){Drupal.GM3.region=function(b){this.GM3=b;this.geo=new google.maps.Geocoder();this.countries=new Object();if(this.GM3.libraries.region.regions){this.add_polygons_by_ids(this.GM3.libraries.region.regions,false,false,true)}};Drupal.GM3.region.prototype.add_polygons_by_ids=function(j,g,f,b){if(typeof j!="object"){if(typeof j=="string"){j=new Array(j)}else{return}}var c=new Array();for(var d in j){if(this.countries[j[d]]==undefined){this.countries[j[d]]=new Array();c[c.length]=j[d]}else{this.remove_polygons_by_id(j[d])}}if(c.length){if(c.length>10){var h=c;var j=new Array();var e=-1;for(var d in h){if(d%10==0){e++;j[e]=new Array()}j[e][j[e].length]=h[d]}}else{var j=new Array(j)}var k=this;for(var d in j){a.getJSON(Drupal.settings.gm3_region.callback+"/"+j[d].join(","),function(r,s,q){for(var p in r){for(var o in r[p]){for(var n in r[p][o]["shape"]["coordinates"]){if(r[p][o]["shape"]["type"]=="MultiPolygon"){for(var m in r[p][o]["shape"]["coordinates"][n]){k.countries[o][k.countries[o].length]=k.GM3.children.polygon.add_polygon(r[p][o]["shape"]["coordinates"][n][m],false)}}else{if(r[p][o]["shape"]["type"]=="Polygon"){k.countries[o][k.countries[o].length]=k.GM3.children.polygon.add_polygon(r[p][o]["shape"]["coordinates"][n],false)}}}}}if(typeof b!="undefined"&&b){if(k.GM3.max_lat){k.GM3.google_map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(k.GM3.min_lat,k.GM3.min_lng),new google.maps.LatLng(k.GM3.max_lat,k.GM3.max_lng)))}}})}}};Drupal.GM3.region.prototype.remove_polygons_by_id=function(c){for(var b in this.countries[c]){this.countries[c][b].setMap(null)}this.countries[c]=undefined};Drupal.GM3.region.prototype.active=function(){this.GM3.google_map.setOptions({draggableCursor:"pointer"})};Drupal.GM3.region.prototype.event=function(e,c,d){switch(this.GM3.active_class){case"region":switch(e){case"click":var b=this;this.geo.geocode({location:c.latLng},function(f,h){if(h==="OK"){for(i in f){if(f[i].types[0]&&f[i].types[0]=="country"&&f[i].types[1]&&f[i].types[1]=="political"){var g=f[i].address_components[0]["short_name"];a.getJSON(Drupal.settings.gm3_region.callback2+"/"+c.latLng.toString()+"/"+g,function(j){if(j){b.add_polygons_by_ids(j);this.update_field()}})}}}});break;case"rightclick":this.GM3.set_active_class("default");break}break}}})(jQuery);