(function(a){Drupal.GM3.field_region=function(b){b.children.region.active=function(){b.children.region.selecting_level=this.get_level_from_zoom(this.GM3.google_map.getZoom());b.children.region.clicked_on_country=false;a("#"+this.GM3.id).append('<div class="gm3_information" style="cursor:pointer"><p>'+this.get_message_from_level(this.selecting_level)+"</p></div>");var c=this;a("#"+this.GM3.id+" .gm3_information").click(function(){if(c.selecting_level<2){c.selecting_level=4}else{c.selecting_level--}a("#"+c.GM3.id+" .gm3_information p").html(c.get_message_from_level(c.selecting_level))});this.GM3.google_map.setOptions({draggableCursor:"pointer"})};b.children.region.event=function(f,d,e){switch(this.GM3.active_class){case"region":switch(f){case"click":if(this.GM3.max_objects=="-1"||this.GM3.num_objects<this.GM3.max_objects){var c=this;this.geo.geocode({location:d.latLng},function(g,j){if(j==="OK"){for(i in g){if(g[i].types[0]&&g[i].types[0]=="country"&&g[i].types[1]&&g[i].types[1]=="political"){var h=g[i].address_components[0]["short_name"];a.getJSON(Drupal.settings.gm3_region.callback2+"/"+d.latLng.toString()+"/"+h+"/"+c.selecting_level,function(k){c.add_region_from_click(k)})}}}else{if(j==="OVER_QUERY_LIMIT"){this.GM3.message(Drupal.t("Woah, slow down, Google is getting annoyed."),"warning")}else{if(j==="ZERO_RESULTS"){a.getJSON(Drupal.settings.gm3_region.callback2+"/"+d.latLng.toString()+"/UNKNOWN/"+c.selecting_level,function(k){c.add_region_from_click(k)})}else{}}}})}else{this.GM3.message(Drupal.t("Please delete an object from the map before adding another."),"warning")}break;case"rightclick":var c=this;this.geo.geocode({location:d.latLng},function(g,j){if(j==="OK"){for(i in g){if(g[i].types[0]&&g[i].types[0]=="country"&&g[i].types[1]&&g[i].types[1]=="political"){var h=g[i].address_components[0]["short_name"];a.getJSON(Drupal.settings.gm3_region.callback2+"/"+d.latLng.toString()+"/"+h+"/4",function(k){c.remove_region_from_click(k)})}}}else{if(j==="OVER_QUERY_LIMIT"){this.GM3.message(Drupal.t("Woah, slow down, Google is getting annoyed."),"warning")}else{if(j==="ZERO_RESULTS"){a.getJSON(Drupal.settings.gm3_region.callback2+"/"+d.latLng.toString()+"/UNKNOWN/4",function(k){c.remove_region_from_click(k)})}else{}}}});break;case"zoom_changed":this.selecting_level=this.get_level_from_zoom(this.GM3.google_map.getZoom());a("#"+this.GM3.id+" .gm3_information p").html(this.get_message_from_level(this.selecting_level));break}break}}};Drupal.GM3.region.prototype.add_region_from_click=function(d){if(d){var b=true;for(var c in this.countries){if(this.countries[c]==d){b=false}}if(b){this.add_polygons_by_ids(d);this.update_field();this.GM3.num_objects++}else{this.GM3.message(Drupal.t("Already selected that region"))}}};Drupal.GM3.region.prototype.remove_region_from_click=function(d){if(d){d=d.split(":");d[1]=d[0]+":"+d[1];d[2]=d[1]+":"+d[2];d[3]=d[2]+":"+d[3];var b=false;for(var c in d){if(this.countries[d[c]]!=undefined){b=true;this.remove_polygons_by_id(d[c]);this.GM3.num_objects--}}if(b){this.update_field()}}};Drupal.GM3.region.prototype.get_message_from_level=function(b){switch(b){case 1:return Drupal.t("Selecting by continent (Level 1)");case 2:return Drupal.t("Selecting by sub-continent (Level 2)");case 3:return Drupal.t("Selecting by country/subcountry (Level 3)");case 4:default:return Drupal.t("Selecting by country/subcountry (Level 4)")}};Drupal.GM3.region.prototype.get_level_from_zoom=function(b){if(b<3){return 1}else{if(b<5){return 2}else{if(b<6){return 3}}}return 4};Drupal.GM3.region.prototype.update_field=function(){var c=new Array();for(var b in this.countries){if(this.countries[b]!=undefined){c[c.length]=b}}a("."+this.GM3.id+"-region").val(c)}})(jQuery);