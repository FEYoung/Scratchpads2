(function(a){Drupal.GM3.polygon=function(b){this.GM3=b;this.geodesic=false;this.followline1=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:1,strokeWeight:2});this.followline2=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:1,strokeWeight:2});this.polygons=new Array()};Drupal.GM3.polygon.prototype.active=function(){this.GM3.google_map.setOptions({draggableCursor:"crosshair"});this.polygons[this.polygons.length]=new google.maps.Polygon({geodesic:this.geodesic,map:this.GM3.google_map,strokeColor:this.get_line_colour(),strokeOpacity:0.4,strokeWeight:3,path:[]});this.followline1.setPath([]);this.followline2.setPath([]);this.followline1.setMap(this.GM3.google_map);this.followline2.setMap(this.GM3.google_map)};Drupal.GM3.polygon.prototype.event=function(k,e,h){switch(this.GM3.active_class){case"polygon":switch(k){case"click":this.polygons[this.polygons.length-1].stopEdit();this.polygons[this.polygons.length-1].getPath().push(e.latLng);this.polygons[this.polygons.length-1].runEdit(true);break;case"mousemove":var d=this.polygons[this.polygons.length-1].getPath().getLength();if(d>=1){var g=this.polygons[this.polygons.length-1].getPath().getAt(d-1);var c=[g,e.latLng];this.followline1.setPath(c);var f=this.polygons[this.polygons.length-1].getPath().getAt(0);var b=[f,e.latLng];this.followline2.setPath(b)}break;case"rightclick":this.GM3.set_active_class("default");this.followline1.setMap(null);this.followline2.setMap(null);break}break;case"default":switch(k){case"click":if(h.getClass&&h.getClass()=="Polygon"){for(j=0;j<this.polygons.length;j++){this.polygons[j].stopEdit()}h.runEdit()}else{for(j=0;j<this.polygons.length;j++){this.polygons[j].stopEdit()}}break}break}};Drupal.GM3.polygon.prototype.add_transfer_listeners=function(){for(i=0;i<this.polygons.length;i++){if(this.polygons[i]){this.GM3.add_listeners_helper(this.polygons[i])}}};Drupal.GM3.polygon.prototype.get_line_colour=function(){switch(this.polygons.length%8){default:case 0:return"#ff0000";case 1:return"#00ff00";case 2:return"#0000ff";case 3:return"#ffff00";case 4:return"#ff00ff";case 5:return"#00ffff";case 6:return"#000000";case 7:return"#ffffff"}}})(jQuery);