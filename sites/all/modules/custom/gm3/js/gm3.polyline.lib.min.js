if(typeof(google.maps.Polyline.prototype.runEdit)==="undefined"){google.maps.Polyline.prototype.runEdit=function(l){if(!l){l=true}var h=this;if(l){var p=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.sprite,new google.maps.Size(11,11),new google.maps.Point(0,22),new google.maps.Point(6,6));var g=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.sprite,new google.maps.Size(11,11),new google.maps.Point(0,33),new google.maps.Point(6,6));var e=new google.maps.Polyline({map:this.getMap(),strokeColor:this.strokeColor,strokeOpacity:0.2,strokeWeight:this.strokeWeight});var s=function(){this.setIcon(g)};var d=function(){this.setIcon(p)};var f=function(){if(e.getPath().getLength()===0){e.setPath([this.marker.getPosition(),this.getPosition(),h.getPath().getAt(this.marker.inex+1)])}e.getPath().setAt(1,this.getPosition())};var q=function(t){var v=h.getPath().getAt(t.inex);var u=h.getPath().getAt(t.inex-1);if((typeof(v)!=="undefined")&&(typeof(v.ghostMarker)!=="undefined")){if(typeof(google.maps.geometry)==="undefined"){v.ghostMarker.setPosition(new google.maps.LatLng(v.lat()+0.5*(h.getPath().getAt(t.inex+1).lat()-v.lat()),v.lng()+0.5*(h.getPath().getAt(t.inex+1).lng()-v.lng())))}else{v.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(v,h.getPath().getAt(t.inex+1),0.5))}}if((typeof(u)!=="undefined")&&(typeof(u.ghostMarker)!=="undefined")){if(typeof(google.maps.geometry)==="undefined"){u.ghostMarker.setPosition(new google.maps.LatLng(u.lat()+0.5*(t.getPosition().lat()-u.lat()),u.lng()+0.5*(t.getPosition().lng()-u.lng())))}else{u.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(u,t.getPosition(),0.5))}}};var m=function(){e.getPath().forEach(function(){e.getPath().pop()});h.getPath().insertAt(this.marker.inex+1,this.getPosition());r(h.getPath().getAt(this.marker.inex+1)).inex=this.marker.inex+1;q(this.marker);i(h.getPath().getAt(this.marker.inex+1));h.getPath().forEach(function(t,u){if(t.marker){t.marker.inex=u}})};var i=function(u){if(u.marker.inex<h.getPath().getLength()-1){var t=new google.maps.Marker({position:(typeof(google.maps.geometry)==="undefined")?new google.maps.LatLng(u.lat()+0.5*(h.getPath().getAt(u.marker.inex+1).lat()-u.lat()),u.lng()+0.5*(h.getPath().getAt(u.marker.inex+1).lng()-u.lng())):google.maps.geometry.spherical.interpolate(u,h.getPath().getAt(u.marker.inex+1),0.5),map:h.getMap(),icon:p,draggable:true,raiseOnDrag:false});google.maps.event.addListener(t,"mouseover",s);google.maps.event.addListener(t,"mouseout",d);google.maps.event.addListener(t,"drag",f);google.maps.event.addListener(t,"dragend",m);u.ghostMarker=t;t.marker=u.marker;return t}return null}}var a=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.sprite,new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));var n=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.sprite,new google.maps.Size(11,11),new google.maps.Point(0,11),new google.maps.Point(6,6));var b=function(){this.setIcon(n)};var k=function(){this.setIcon(a)};var j=function(){var t=this.getPosition();t.marker=this;t.ghostMarker=h.getPath().getAt(this.inex).ghostMarker;h.getPath().setAt(this.inex,t);if(l){q(this)}};var c=function(){if(l){var u=h.getPath().getAt(this.inex);var t=h.getPath().getAt(this.inex-1);if(typeof(u.ghostMarker)!=="undefined"){u.ghostMarker.setMap(null)}h.getPath().removeAt(this.inex);if(typeof(t)!=="undefined"){if(this.inex<h.getPath().getLength()){q(t.marker)}else{t.ghostMarker.setMap(null);t.ghostMarker=undefined}}}else{h.getPath().removeAt(this.inex)}this.setMap(null);h.getPath().forEach(function(v,w){if(v.marker){v.marker.inex=w}});if(h.getPath().getLength()===1){h.getPath().pop().marker.setMap(null)}};var o=function(){google.maps.event.trigger(h.map,"rightclick");h.stopEdit()};var r=function(t){var u=new google.maps.Marker({position:t,map:h.getMap(),icon:a,draggable:true,raiseOnDrag:false});google.maps.event.addListener(u,"mouseover",b);google.maps.event.addListener(u,"mouseout",k);google.maps.event.addListener(u,"drag",j);google.maps.event.addListener(u,"rightclick",c);google.maps.event.addListener(u,"click",o);t.marker=u;return u};this.getPath().forEach(function(t,u){r(t).inex=u;if(l){i(t)}})}}if(typeof(google.maps.Polyline.prototype.stopEdit)==="undefined"){google.maps.Polyline.prototype.stopEdit=function(){this.getPath().forEach(function(a,b){if(a.marker){a.marker.setMap(null);a.marker=undefined}if(a.ghostMarker){a.ghostMarker.setMap(null);a.ghostMarker=undefined}})}};