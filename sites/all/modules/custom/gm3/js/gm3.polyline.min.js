(function(a){Drupal.GM3.polyline=function(d){this.GM3=d;this.geodesic=false;this.followline=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:1,strokeWeight:2});this.polylines=new Array();if(this.GM3.libraries.polyline.polylines){for(var b in this.GM3.libraries.polyline.polylines){if(typeof(this.GM3.libraries.polyline.polylines[b]["polyline"])=="undefined"){this.add_polyline(this.GM3.libraries.polyline.polylines[b])}else{var c=typeof(this.GM3.libraries.polyline.polylines[b]["content"])!="undefined"?this.GM3.libraries.polyline.polylines[b]["content"]:"";var e=typeof(this.GM3.libraries.polyline.polylines[b]["title"])!="undefined"?this.GM3.libraries.polyline.polylines[b]["title"]:"";this.add_polyline(this.GM3.libraries.polyline.polylines[b]["polyline"],this.GM3.libraries.polyline.polylines[b]["editable"],c)}}}};Drupal.GM3.polyline.prototype.active=function(){this.GM3.google_map.setOptions({draggableCursor:"pointer"});this.polylines[this.polylines.length]=new google.maps.Polyline({geodesic:this.geodesic,map:this.GM3.google_map,strokeColor:this.get_line_colour(),strokeOpacity:0.4,strokeWeight:3,path:[]});this.followline.setPath([]);this.followline.setMap(this.GM3.google_map)};Drupal.GM3.polygon.prototype.add_polyline=function(f,e,g,h){var b=new Array();for(var d=0;d<f.length;d++){if(f[d]["lat"]==undefined){if(typeof f[d]=="object"){f[d]=String(f[d])}f[d]=f[d].split(",");b[d]=new google.maps.LatLng(f[d][1],f[d][0])}else{b[d]=new google.maps.LatLng(f[d]["lat"],f[d]["long"])}this.GM3.add_latlng(b[d])}if(e){this.polylines[this.polylines.length]=new google.maps.Polyline({geodesic:this.geodesic,map:this.GM3.google_map,strokeColor:this.get_line_colour(),strokeOpacity:0.4,strokeWeight:3,path:b})}else{g=typeof(g)!="undefined"?g:"";h=typeof(h)!="undefined"?h:"";var c=new google.maps.Polyline({geodesic:this.geodesic,map:this.GM3.google_map,strokeColor:"#000000",strokeOpacity:0.4,strokeWeight:1,path:b});this.GM3.add_listeners_helper(c);if(g){this.GM3.add_popup(c,g,h)}return c}};Drupal.GM3.polyline.prototype.event=function(h,e,g){switch(this.GM3.active_class){case"polyline":switch(h){case"click":if(this.polylines[this.polylines.length-1].getPath().length==0){if(this.GM3.num_objects<this.GM3.max_objects){this.GM3.num_objects++}else{alert(Drupal.t("Please delete an object from the map before adding another"));break}}this.polylines[this.polylines.length-1].stopEdit();this.polylines[this.polylines.length-1].getPath().push(e.latLng);this.polylines[this.polylines.length-1].runEdit(true);if(this.update_field){this.update_field()}break;case"mousemove":var d=this.polylines[this.polylines.length-1].getPath().getLength();if(d>=1){var c=this.polylines[this.polylines.length-1].getPath().getAt(d-1);var f=[c,e.latLng];this.followline.setPath(f)}break;case"rightclick":this.GM3.set_active_class("default");this.followline.setMap(null);if(this.update_field){this.update_field()}break}break;case"default":switch(h){case"click":if(g.getClass&&g.getClass()=="Polyline"){for(var b=0;b<this.polylines.length;b++){this.polylines[b].stopEdit()}g.runEdit()}else{for(var b=0;b<this.polylines.length;b++){this.polylines[b].stopEdit()}}if(this.update_field){this.update_field()}break}break}};Drupal.GM3.polyline.prototype.add_transfer_listeners=function(){for(var b=0;b<this.polylines.length;b++){if(this.polylines[b]){this.GM3.add_listeners_helper(this.polylines[b])}}};Drupal.GM3.polyline.prototype.get_line_colour=function(){switch(this.polylines.length%8){default:case 0:return"#ff0000";case 1:return"#00ff00";case 2:return"#0000ff";case 3:return"#ffff00";case 4:return"#ff00ff";case 5:return"#00ffff";case 6:return"#000000";case 7:return"#ffffff"}}})(jQuery);