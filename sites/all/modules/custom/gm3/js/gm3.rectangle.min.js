(function(a){Drupal.GM3.rectangle=function(d){this.GM3=d;this.geodesic=false;this.followlineN=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:0.7,strokeWeight:2});this.followlineE=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:0.7,strokeWeight:2});this.followlineS=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:0.7,strokeWeight:2});this.followlineW=new google.maps.Polyline({geodesic:this.geodesic,clickable:false,path:[],strokeColor:"#787878",strokeOpacity:0.7,strokeWeight:2});this.firstclick=false;this.rectangles=new Array();if(this.GM3.libraries.rectangle.rectangles){for(var b in this.GM3.libraries.rectangle.rectangles){if(typeof(this.GM3.libraries.rectangle.rectangles[b]["rectangle"])=="undefined"){this.rectangles[this.rectangles.length]=this.GM3.children.polygon.add_polygon(this.GM3.libraries.rectangle.rectangles[b],false)}else{var c=typeof(this.GM3.libraries.rectangle.rectangles[b]["content"])!="undefined"?this.GM3.libraries.rectangle.rectangles[b]["content"]:"";var e=typeof(this.GM3.libraries.rectangle.rectangles[b]["title"])!="undefined"?this.GM3.libraries.rectangle.rectangles[b]["title"]:"";this.GM3.children.polygon.add_polygon(this.GM3.libraries.rectangle.rectangles[b]["rectangle"],this.GM3.libraries.rectangle.rectangles[b]["editable"],c,e)}}}this.add_transfer_listeners()};Drupal.GM3.rectangle.prototype.active=function(){this.GM3.google_map.setOptions({draggableCursor:"pointer"});this.first_click=false;this.followlineN.setPath([]);this.followlineN.setMap(this.GM3.google_map);this.followlineE.setPath([]);this.followlineE.setMap(this.GM3.google_map);this.followlineS.setPath([]);this.followlineS.setMap(this.GM3.google_map);this.followlineW.setPath([]);this.followlineW.setMap(this.GM3.google_map)};Drupal.GM3.rectangle.prototype.event=function(c,b,h){switch(this.GM3.active_class){case"rectangle":switch(c){case"click":if(this.GM3.max_objects=="-1"||this.GM3.num_objects<this.GM3.max_objects){if(this.first_click){var k=new Array({lat:this.first_click.latLng.lat(),"long":this.first_click.latLng.lng()},{lat:this.first_click.latLng.lat(),"long":b.latLng.lng()},{lat:b.latLng.lat(),"long":b.latLng.lng()},{lat:b.latLng.lat(),"long":this.first_click.latLng.lng()});this.rectangles[this.rectangles.length]=this.GM3.children.polygon.add_polygon(k,false);this.GM3.num_objects++;this.GM3.set_active_class("default");this.followlineN.setMap(null);this.followlineE.setMap(null);this.followlineS.setMap(null);this.followlineW.setMap(null);if(this.update_field){this.update_field()}}else{this.first_click=b}}else{this.GM3.message(Drupal.t("Please delete an object from the map before adding another"),"warning")}break;case"mousemove":if(this.first_click){var g=new google.maps.LatLng(this.first_click.latLng.lat(),b.latLng.lng());var d=new google.maps.LatLng(b.latLng.lat(),this.first_click.latLng.lng());this.followlineN.setPath([this.first_click.latLng,g]);this.followlineE.setPath([g,b.latLng]);this.followlineS.setPath([b.latLng,d]);this.followlineW.setPath([d,this.first_click.latLng])}break;case"rightclick":if(h.getClass()=="Polygon"){for(var f=0;f<this.rectangles.length;f++){if(this.rectangles[f]==h){this.rectangles[f].setMap(null);this.rectangles[f]=null}}}var l=new Array();var e=0;for(var f=0;f<this.rectangles.length;f++){if(this.rectangles[f]!=undefined){l[e]=this.rectangles[f];e++}}this.rectangles=l;if(this.update_field){this.update_field()}this.GM3.set_active_class("default");this.followlineN.setMap(null);this.followlineE.setMap(null);this.followlineS.setMap(null);this.followlineW.setMap(null);break}break}};Drupal.GM3.rectangle.prototype.add_transfer_listeners=function(){for(var b=0;b<this.rectangles.length;b++){if(this.rectangles[b]){this.GM3.add_listeners_helper(this.rectangles[b])}}};Drupal.GM3.rectangle.prototype.get_line_colour=function(){switch(this.rectangles.length%8){default:case 0:return"#ff0000";case 1:return"#00ff00";case 2:return"#0000ff";case 3:return"#ffff00";case 4:return"#ff00ff";case 5:return"#00ffff";case 6:return"#000000";case 7:return"#ffffff"}}})(jQuery);