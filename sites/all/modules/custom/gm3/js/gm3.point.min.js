(function(a){Drupal.GM3.point=function(d){this.GM3=d;this.points=new Array();this.markers=new Array();this.marker_image=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.sprite,new google.maps.Size(16,16),new google.maps.Point(0,44),new google.maps.Point(8,8));if(this.GM3.libraries.point.points){for(var c in this.GM3.libraries.point.points){var b=typeof(this.GM3.libraries.point.points[c]["editable"])!="undefined"?this.GM3.libraries.point.points[c]["editable"]:false;this.add_marker(new google.maps.LatLng(this.GM3.libraries.point.points[c]["latitude"],this.GM3.libraries.point.points[c]["longitude"]),b,false,this.GM3.libraries.point.points[c]["title"],this.GM3.libraries.point.points[c]["content"])}}this.clusterer=new MarkerClusterer(this.GM3.google_map,this.points,{averageCenter:true,maxZoom:12,minimumClusterSize:5});this.autofit=typeof(this.GM3.libraries.point.autofit)!="undefined"?this.GM3.libraries.point.autofit:false;if(this.autofit){this.clusterer.fitMapToMarkers()}};Drupal.GM3.point.prototype.active=function(){this.GM3.google_map.setOptions({draggableCursor:"pointer"})};Drupal.GM3.point.prototype.add_marker=function(d,b,g,f,c){g=typeof(g)!="undefined"?g:false;f=typeof(f)!="undefined"?f:"";c=typeof(c)!="undefined"?c:"";var e=this.points.length;this.points[e]=new google.maps.Marker({position:d,draggable:b,title:f+" :: "+d.toString(),icon:this.marker_image});this.GM3.add_listeners_helper(this.points[e]);if(c){this.GM3.add_popup(this.points[e],c,f)}if(g){this.clusterer.addMarker(this.points[e],true);this.clusterer.repaint()}};Drupal.GM3.point.prototype.event=function(g,d,f){switch(this.GM3.active_class){case"point":switch(g){case"click":this.add_marker(d.latLng,true,true);if(this.update_field){this.update_field()}break;case"rightclick":switch(f.getClass()){case"Map":this.GM3.set_active_class("default");break;case"Marker":for(var c=0;c<this.points.length;c++){if(this.points[c].position.equals(f.position)){this.clusterer.removeMarker(this.points[c],true);this.points[c].setMap(null);this.points[c]=undefined}}var e=new Array();var b=0;for(var c=0;c<this.points.length;c++){if(this.points[c]!=undefined){e[b]=this.points[c];b++}}this.points=e;if(this.update_field){this.update_field()}break}break}break}}})(jQuery);