(function(a){Drupal.GM3.point=function(c){this.GM3=c;this.points=new Array();this.markers=new Array();this.marker_image=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.sprite,new google.maps.Size(16,16),new google.maps.Point(0,44),new google.maps.Point(8,8));if(this.GM3.libraries.point.points){for(var b in this.GM3.libraries.point.points){this.add_marker(new google.maps.LatLng(this.GM3.libraries.point.points[b]["lat"],this.GM3.libraries.point.points[b]["long"]),false,this.GM3.libraries.point.points[b]["title"],this.GM3.libraries.point.points[b]["content"])}}this.clusterer=new MarkerClusterer(this.GM3.google_map,this.points,{averageCenter:true,maxZoom:12,minimumClusterSize:5});this.autofit=typeof(this.GM3.libraries.point.autofit)!="undefined"?this.GM3.libraries.point.autofit:false;if(this.autofit){this.clusterer.fitMapToMarkers()}};Drupal.GM3.point.prototype.active=function(){this.GM3.google_map.setOptions({draggableCursor:"pointer"})};Drupal.GM3.point.prototype.add_marker=function(c,f,e,b){f=typeof(f)!="undefined"?f:false;e=typeof(e)!="undefined"?e:"";b=typeof(b)!="undefined"?b:"";var d=this.points.length;this.points[d]=new google.maps.Marker({position:c,draggable:true,title:e+" :: "+c.toString(),icon:this.marker_image});if(b){google.maps.event.addListener(this.points[d],"click",function(g){var h=new InfoBubble({map:this.map,content:b,position:c,shadowStyle:1,padding:0,borderRadius:4,arrowSize:10,borderWidth:1,borderColor:"#2c2c2c",disableAutoPan:true,hideCloseButton:true,arrowPosition:30,backgroundClassName:"phoney",arrowStyle:2});h.open()})}if(f){this.clusterer.addMarker(this.points[d],true);this.clusterer.repaint()}this.GM3.add_listeners_helper(this.points[d])};Drupal.GM3.point.prototype.event=function(g,d,f){switch(this.GM3.active_class){case"point":switch(g){case"click":this.add_marker(d.latLng,true);break;case"rightclick":switch(f.getClass()){case"Map":this.GM3.set_active_class("default");break;case"Marker":for(var c=0;c<this.points.length;c++){if(this.points[c].position.equals(f.position)){this.clusterer.removeMarker(this.points[c],true);this.points[c].setMap(null);this.points[c]=undefined}}var e=new Array();var b=0;for(var c=0;c<this.points.length;c++){if(this.points[c]!=undefined){e[b]=this.points[c];b++}}this.points=e;break}break}break}};Drupal.GM3.point.prototype.add_transfer_listeners=function(){for(var b=0;b<this.points.length;b++){if(this.points[b]){this.GM3.add_listeners_helper(this.points[b])}}}})(jQuery);