if(typeof google.maps.Polygon.prototype.runEdit==="undefined"){google.maps.Polygon.prototype.runEdit=function(a){if(!a){a=true}var b=this;if(a){var c=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.ghostvertex,new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));var d=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.ghostvertexover,new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));var e=new google.maps.Polygon({map:this.getMap(),strokeColor:this.strokeColor,strokeOpacity:.2,strokeWeight:this.strokeWeight});var f=function(){this.setIcon(d)};var g=function(){this.setIcon(c)};var h=function(){if(e.getPath().getLength()===0){if(this.marker.inex<b.getPath().getLength()-1){e.setPath([this.marker.getPosition(),this.getPosition(),b.getPath().getAt(this.marker.inex+1)])}else{if(this.marker.inex===b.getPath().getLength()-1){e.setPath([this.marker.getPosition(),this.getPosition(),b.getPath().getAt(0)])}}}e.getPath().setAt(1,this.getPosition())};var i=function(a){var c=b.getPath().getAt(a.inex);if(a.inex===0){var d=b.getPath().getAt(b.getPath().getLength()-1)}else{var d=b.getPath().getAt(a.inex-1)}if(typeof c!=="undefined"&&typeof c.ghostMarker!=="undefined"){if(typeof google.maps.geometry==="undefined"){if(a.inex<b.getPath().getLength()-1){c.ghostMarker.setPosition(new google.maps.LatLng(c.lat()+.5*(b.getPath().getAt(a.inex+1).lat()-c.lat()),c.lng()+.5*(b.getPath().getAt(a.inex+1).lng()-c.lng())))}else{if(a.inex===b.getPath().getLength()-1){c.ghostMarker.setPosition(new google.maps.LatLng(c.lat()+.5*(b.getPath().getAt(0).lat()-c.lat()),c.lng()+.5*(b.getPath().getAt(0).lng()-c.lng())))}}}else{if(a.inex<b.getPath().getLength()-1){c.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(c,b.getPath().getAt(a.inex+1),.5))}else{if(a.inex===b.getPath().getLength()-1){c.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(c,b.getPath().getAt(0),.5))}}}}if(typeof d!=="undefined"&&typeof d.ghostMarker!=="undefined"){if(typeof google.maps.geometry==="undefined"){d.ghostMarker.setPosition(new google.maps.LatLng(d.lat()+.5*(a.getPosition().lat()-d.lat()),d.lng()+.5*(a.getPosition().lng()-d.lng())))}else{d.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(d,a.getPosition(),.5))}}};var j=function(){e.getPath().forEach(function(){e.getPath().pop()});b.getPath().insertAt(this.marker.inex+1,this.getPosition());r(b.getPath().getAt(this.marker.inex+1)).inex=this.marker.inex+1;i(this.marker);k(b.getPath().getAt(this.marker.inex+1));b.getPath().forEach(function(a,b){if(a.marker){a.marker.inex=b}})};var k=function(a){if(a.marker.inex<b.getPath().getLength()-1){var d=new google.maps.Marker({position:typeof google.maps.geometry==="undefined"?new google.maps.LatLng(a.lat()+.5*(b.getPath().getAt(a.marker.inex+1).lat()-a.lat()),a.lng()+.5*(b.getPath().getAt(a.marker.inex+1).lng()-a.lng())):google.maps.geometry.spherical.interpolate(a,b.getPath().getAt(a.marker.inex+1),.5),map:b.getMap(),icon:c,draggable:true,raiseOnDrag:false});google.maps.event.addListener(d,"mouseover",f);google.maps.event.addListener(d,"mouseout",g);google.maps.event.addListener(d,"drag",h);google.maps.event.addListener(d,"dragend",j);a.ghostMarker=d;d.marker=a.marker;return d}else{if(a.marker.inex===b.getPath().getLength()-1){var d=new google.maps.Marker({position:typeof google.maps.geometry==="undefined"?new google.maps.LatLng(a.lat()+.5*(b.getPath().getAt(0).lat()-a.lat()),a.lng()+.5*(b.getPath().getAt(0).lng()-a.lng())):google.maps.geometry.spherical.interpolate(a,b.getPath().getAt(0),.5),map:b.getMap(),icon:c,draggable:true,raiseOnDrag:false});google.maps.event.addListener(d,"mouseover",f);google.maps.event.addListener(d,"mouseout",g);google.maps.event.addListener(d,"drag",h);google.maps.event.addListener(d,"dragend",j);a.ghostMarker=d;d.marker=a.marker;return d}}return null}}var l=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.vertex,new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));var m=new google.maps.MarkerImage(Drupal.settings.gm3.settings.images.vertexover,new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));var n=function(){this.setIcon(m)};var o=function(){this.setIcon(l)};var p=function(){var c=this.getPosition();c.marker=this;c.ghostMarker=b.getPath().getAt(this.inex).ghostMarker;b.getPath().setAt(this.inex,c);if(a){i(this)}};var q=function(){if(a){var c=b.getPath().getAt(this.inex);if(this.inex===0){var d=b.getPath().getAt(b.getPath().getLength()-1)}else{var d=b.getPath().getAt(this.inex-1)}if(typeof c.ghostMarker!=="undefined"){c.ghostMarker.setMap(null)}b.getPath().removeAt(this.inex);b.getPath().forEach(function(a,b){if(a.marker){a.marker.inex=b}});if(typeof d!=="undefined"){if(this.inex<=b.getPath().getLength()){i(d.marker)}else{d.ghostMarker.setMap(null);d.ghostMarker=undefined}}}else{b.getPath().removeAt(this.inex)}this.setMap(null);if(b.getPath().getLength()===1){d.ghostMarker.setMap(null);b.getPath().pop().marker.setMap(null)}};var r=function(a){var c=new google.maps.Marker({position:a,map:b.getMap(),icon:l,draggable:true,raiseOnDrag:false});google.maps.event.addListener(c,"mouseover",n);google.maps.event.addListener(c,"mouseout",o);google.maps.event.addListener(c,"drag",p);google.maps.event.addListener(c,"rightclick",q);a.marker=c;return c};this.getPath().forEach(function(b,c){r(b).inex=c;if(a){k(b)}})}}if(typeof google.maps.Polygon.prototype.stopEdit==="undefined"){google.maps.Polygon.prototype.stopEdit=function(){this.getPath().forEach(function(a,b){if(a.marker){a.marker.setMap(null);a.marker=undefined}if(a.ghostMarker){a.ghostMarker.setMap(null);a.ghostMarker=undefined}})}}