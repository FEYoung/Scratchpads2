<?php

/**
 * Implementation of hook_form_FORM_ID_alter().
 */
function leftandright_form_taxonomy_overview_vocabularies_alter(&$form, &$form_state, $form_id){
  $vocabularies = taxonomy_get_vocabularies();
  foreach($vocabularies as $vocabulary){
    $form[$vocabulary->vid]['rebuildlandr'] = array(
      '#type' => 'link',
      '#title' => t('rebuild tree'),
      '#href' => "admin/structure/taxonomy/$vocabulary->machine_name/rebuild"
    );
  }
  $form['#theme'] = array(
    'leftandright_taxonomy_overview_vocabularies'
  );
}

/**
 * Implementation of hook_menu
 */
function leftandright_menu(){
  return array(
    'admin/structure/taxonomy/%taxonomy_vocabulary_machine_name/rebuild' => array(
      'title' => 'Rebuild',
      'page callback' => 'drupal_get_form',
      'page arguments' => array(
        'leftandright_rebuild_tree_form',
        3
      ),
      'access arguments' => array(
        'administer taxonomy'
      ),
      'type' => MENU_LOCAL_TASK,
      'weight' => -10,
      'file' => 'leftandright.admin.inc'
    )
  );
}

/**
 * Implementation of hook_theme().
 */
function leftandright_theme(){
  return array(
    'leftandright_taxonomy_overview_vocabularies' => array(
      'render element' => 'form',
      'file' => 'leftandright.theme.inc'
    )
  );
}

/**
 * Implementations of hook_taxonomy_insert
 */
function leftandright_taxonomy_term_insert($term){
  module_load_include('functions.inc', 'leftandright');
  leftandright_insert($term);
}

/**
 * Implementations of hook_taxonomy_update
 */
function leftandright_taxonomy_term_update($term){
  // Simply do a delete, then an insert.
  // Nice if we could start a transaction here, then commit it at the end.
  module_load_include('functions.inc', 'leftandright');
  leftandright_taxonomy_term_delete($term);
  leftandright_taxonomy_term_insert($term);
}

/**
 * Implementations of hook_taxonomy_delete
 */
function leftandright_taxonomy_term_delete($term){
  module_load_include('functions.inc', 'leftandright');
  leftandright_delete($term);
}

/**
 * Implementation of hook_viewsapi
 */
function leftandright_views_api(){
  return array(
    'api' => 2,
    'path' => drupal_get_path('module', 'leftandright') . "/views"
  );
}